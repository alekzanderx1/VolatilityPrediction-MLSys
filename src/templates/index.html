<!DOCTYPE html>
<html>
<head>
	<title>{{ project }} app</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<script type="text/javascript">

    $(function() {
        $('#loadResults').click(function() {
            event.preventDefault();
            var data = $('#myform').serializeArray();
            console.log(JSON.stringify(data));
            $.ajax({
                type: 'POST',
                url: '/predict',
                data: JSON.stringify(data),
                dataType : 'json',
				contentType: 'application/json',
				success : (data) => {
					result1 = "Prediction Miss rate for Group: " + data.gender + " is " + data.groupMissRate 
					result2 = ""
					result3 = ""
					diff = Math.abs(data.testMissRate - data.groupMissRate) 
					if(data.gender != "all" ) {
						result2 = "In comparision, Overall Miss Rate on test set is: " + data.testMissRate
						if(diff < 0.2) {
							result3 = "Hence, the models performance for this group seems fair."
						} 
						else if (diff > 0.2) {
							result3 = "Hence, the models performance for this group seems unfair or slightly biased."
						}
					}
					
					$('#result1').text(result1);
					$('#result2').text(result2);
					$('#result3').text(result3);
				},
				error : (data) => {
					alert('error!');
				}
            });
        });
    }); 

</script>
<body>
	<h1>{{ project }}</h1>
	<h2> Results for Volatility Prediction</h2>
	<p>Best Classifier: {{vol_best_model_type}}</p>
	<p>Classifier R2 score: {{vol_best_r2}}</p>
	<h2> Results for Market Excess Return Prediction</h2>
	<p>Best Classifier: {{er_best_model_type}}</p>
	<p>Classifier R2 score: {{er_best_r2}}</p>
	</br>
	<h2>Make a prediction</h2>
	<form id="myform" method="POST">
		<label for="pipelines">Choose the Prediction Target:</label>
		<select name="PipelineType" id="pipelines">
		  <option value="Volatility">Volatility</option>
		  <option value="ExcessReturn">ExcessReturn</option>
		</select>
		<label for="lagValues">Lag Values(, separated)</label>
  		<input type="text" id="lagValues" name="lagValues"><br>
	</form>
	</br>
	<button id="loadResults">Load Results</button>
	</br>
	</br>
	<h2 id="result1"></h2>
	<p id="result2"></p>
	<p id="result3"></p>
</body>
</html>